\documentclass[lettersize,journal]{IEEEtran}
\usepackage{amsmath,amsfonts}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{array}
\usepackage[caption=false,font=normalsize,labelfont=sf,textfont=sf]{subfig}
\usepackage{textcomp}
\usepackage{stfloats}
\usepackage{url}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{cite}

%opening
\title{A neural network lpv framework for ecm battery models}
\author{Diogo Lopes Fernandes}

\begin{document}

\maketitle

\begin{abstract}

\end{abstract}

\section{Introduction}

The global transition towards electrification and sustainable energy systems has established lithium-ion batteries (LIBs) as the predominant energy storage technology for high-demand applications. Owing to their high energy density, long cycle life, and low self-discharge rates, LIBs are integral to the operation of modern electric vehicles (EVs), hybrid electric vehicles (HEVs), e-bikes, and autonomous mobile robots\cite{mawuntu2023modeling}. The viability, safety, and performance of these systems are directly dependent on the precise and reliable operation of the energy storage unit.

To ensure this reliability, a sophisticated Battery Management System (BMS) is essential for monitoring and controlling the battery pack\cite{tekin2024comparative}. The primary functions of a BMS include ensuring operation within the safe operating area (SOA), managing cell balancing, and — most critically — providing accurate real-time estimations of the battery's internal states, such as the State of Charge (SoC) and the State of Health (SoH)\cite{damodaran2024fast}. The fidelity of these estimations is entirely reliant on the accuracy of the underlying battery model used by the BMS algorithms\cite{tran2021comprehensive}, especially under the dynamic load profiles of automotive or robotic applications.

Battery modeling strategies are broadly categorized into three main families. The first is physics-based (or electrochemical) models, which offer the highest fidelity by describing the internal electrochemical processes. The foundational model in this category is the Doyle-Fuller-Newman (DFN) model, also known as the Pseudo-two-Dimensional (P2D) model\cite{piruzjam2024analytical}. While comprehensive, the DFN model involves complex systems of partial differential equations (PDEs), making it computationally prohibitive for real-time BMS applications\cite{khalik2021model}. Consequently, significant research focuses on developing Reduced-Order Models, such as the Single Particle Model (SPM)\cite{li2018single, piruzjam2024analytical}, or designing complex state observers for the DFN model itself\cite{drummond2019observer}, all attempting to balance physical accuracy with computational feasibility.

A second major category is empirical or data-driven models. These "black-box" approaches leverage machine learning (ML) algorithms, such as Recurrent Neural Networks (RNN), NARX networks, or Support Vector Machines (SVM), to map battery inputs (e.g., current, temperature) directly to outputs (e.g., voltage, SoC)\cite{kawahara2023battery, wang2021coestimation, xia2024hybrid}. While these models can achieve high accuracy, they often require large and diverse training datasets and face significant challenges with extrapolation, generalization, and a lack of physical interpretability\cite{valizadeh2024machine, kawahara2023battery}.

The third approach, which strikes an optimal balance for BMS applications, is the Equivalent Circuit Model (ECM). This category has become the industry standard due to their intuitive structure, low computational overhead, and sufficient accuracy for state estimation\cite{tekin2024comparative}. These models represent the battery's electrical behavior using a combination of electrical components, including a voltage source (representing the Open-Circuit Voltage or OCV), an internal ohmic resistance ($R_{int}$), and one or more Resistor-Capacitor (RC) pairs to capture the dynamic polarization phenomena\cite{khalfi2021electric}.

The primary challenge in deploying high-fidelity ECMs, however, is their parameterization. The values of the circuit components (resistances and capacitances) are not constant; instead, they exhibit pronounced non-linear dependencies on the battery's operating conditions, including the State of Charge (SoC), temperature, and the battery's State of Health (SoH), or aging level\cite{tran2021comprehensive, Sheikh2024}. Ignoring these variations leads to significant errors in state estimation. Therefore, accurate battery modeling necessitates not only a suitable ECM structure but also robust online parameter identification techniques capable of tracking these multi-timescale parameter variations in real-time\cite{pai2023online, yang2023improved, beelen2018experiment}.

To address this challenge, this work proposes a hybrid grey-box modeling framework in which the ECM parameters are modeled as non-linear functions of internal battery states. The physical structure of the ECM is preserved, but the parameters $( R_0, R_1, C_1 )$ are dynamically scheduled using shallow neural networks trained to capture their variation across operating conditions \cite{Sheikh2024}. Three neural architectures are investigated: Deep Neural Networks (DNNs) with a single hidden layer using ReLU and tanh activations, Radial Basis Function Neural Networks (RBFNNs) employing localized activation functions including Gaussian, Inverse Quadratic, Inverse Quadric, Hyperbolic Tangent, and Thin Plate Splines, and Wavelet Neural Networks with a single hidden layer using Mexican Hat wavelet function.

The proposed hybrid models are benchmarked against conventional grey-box ECMs with static parameters and models based on transfer function identification. This comparative analysis aims to demonstrate the superior fidelity and generalization capability of the hybrid architecture, particularly under dynamic load profiles and across varying operating conditions.

\section{Equivalent Circuit Models}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{"ECM models"}
	\caption{Equivalent Circuit Models (a) 1RC model (b) 2RC Model (c) Improved PNGV model.}
	\label{fig:ecm-models}
\end{figure}

\subsection{First-Order Equivalent Circuit Model (1RC)}

The first-order Equivalent Circuit Model (ECM), often referred to as the first-order Thevenin model or simply the 1RC model, is widely considered the industry standard for Battery Management System (BMS) applications\cite{tekin2024comparative}. Its predominance is due to the fact that it offers an ideal balance between model fidelity and computational complexity. Although it is significantly more accurate than the simple $R_{int}$ (Internal Resistance) model by capturing the battery's transient dynamic response, it remains computationally lightweight enough to be executed in real-time on BMS microcontrollers, unlike complex electrochemical models \cite{mawuntu2023modeling}.

The 1RC model structure represents the battery's electrical behavior through a circuit composed of four main components, where each models a distinct physical phenomenon. The Open-Circuit Voltage (OCV) is an ideal voltage source representing the battery's thermodynamic equilibrium potential, and it has a strong non-linear relationship with the battery's State of Charge (SoC) \cite{tran2021comprehensive}. The Ohmic Resistor ($R_0$), also called the internal resistance, models the instantaneous Joule effect losses, and, physically, it represents the combined resistance of the electrolyte, separators, and electrical contacts. The RC Pair ($R_1$ and $C_1$) is the core of the model's dynamic part. The pair, composed of a resistor ($R_1$) and a capacitor ($C_1$) in parallel, models the battery's transient phenomena, primarily the charge-transfer polarization ($R_1$) and the double-layer capacitance ($C_1$) at the electrode/electrolyte interface.

This model, which is represented in Figure \ref{fig:ecm-models}, is mathematically described by a system of state equations. The two state variables of the model are the State of Charge ($SoC(t)$) and the voltage across the polarization capacitor ($V_1(t)$). The model output is the terminal voltage ($V_t(t)$). Adopting the convention where the current $I(t)$ is positive for discharge, the equations are as follows:

\begin{equation}
	\label{eq:soc}
	\frac{dSoC(t)}{dt} = - \frac{\eta I(t)}{Q}
\end{equation}

\begin{equation}
	\label{eq:v1}
	\frac{dV_1(t)}{dt} = - \frac{V_1(t)}{R_1 C_1} + \frac{I(t)}{C_1}
\end{equation}

The State of Charge is calculated using the Coulomb Counting method, which integrates the current over time, where $\eta$ is the Coulombic efficiency, and $Q$ is the total nominal capacity (in Ampere-seconds)\cite{xie2023state}. The second state equation describes the variation of the voltage $V_1(t)$ across the RC pair by applying Kirchhoff's Current Law at the RC pair's node, where the term $\frac{V_1(t)}{R_1 C_1}$ represents the natural decay of the polarization voltage, and the term $\frac{I(t)}{C_1}$ represents the voltage buildup on the capacitor due to the current flowing into the RC pair.

The terminal voltage $V_t(t)$, which is the voltage measured by the BMS, is calculated by summing the voltage drops in the circuit, based on Kirchhoff's Voltage Law:

\begin{equation}
	\label{eq:vt}
	V_t(t) = V_{OCV}(SoC) - I(t)R_0 - V_1(t)
\end{equation}

The 1RC model serves as a solid foundation for state estimation algorithms like the Extended Kalman Filter (EKF), which leverages its structure to predict battery behavior and refine estimates of $SoC$ and $V_1$ \cite{xie2023state, pai2023online}. However, its parameters ($V_{OCV}$, $R_0$, $R_1$, and $C_1$) are not constant; they vary non-linearly with operating conditions such as SoC, temperature, and State of Health (SoH) \cite{tran2021comprehensive}. Accurate modeling across the full operating range thus requires a robust method to identify and update these parameters in real-time \cite{yang2023improved, pai2023online}.

\subsection{Second-Order Equivalent Circuit Model (2RC)}

To achieve higher fidelity in capturing the battery's dynamic behavior, the 1RC model can be extended. The Second-Order Equivalent Circuit Model (2RC), also known as the Dual Polarization (DP) model, is a common enhancement\cite{tekin2024comparative, khalfi2021electric}. This model is preferred when a single RC pair is insufficient to accurately represent the complex polarization phenomena, which often occur at different timescales.

The 2RC model, as described in Figure \ref{fig:ecm-models}, retains the foundational components of the 1RC model—the OCV voltage source ($V_{OCV}$) and the ohmic resistor ($R_0$), but adds a second RC pair ($R_2$, $C_2$) in series with the first. This structure allows the model to distinguish between two different transient processes\cite{tran2021comprehensive}, where the first RC pair represents the fast dynamics, such as the charge-transfer polarization and double-layer capacitance at the primary interface, and the second represents a slower dynamic process, most commonly associated with mass transport or diffusion polarization within the electrolyte or active material.

By adding the second RC pair, the model's state-space representation is expanded to include three state variables, where third state is the polarization voltage of the second pair ($V_2(t)$). The SOC estimation remains unchanged and is calculated using the Coulomb Counting method, as previously defined in Equation \ref{eq:soc}. But, now two independent state equations are needed to describe the voltage across each RC pair, analogous to the 1RC model's polarization equation:

\begin{equation}
	\label{eq:v1_2rc}
	\frac{dV_1(t)}{dt} = - \frac{V_1(t)}{R_1 C_1} + \frac{I(t)}{C_1}
\end{equation}

\begin{equation}
	\label{eq:v2_2rc}
	\frac{dV_2(t)}{dt} = - \frac{V_2(t)}{R_2 C_2} + \frac{I(t)}{C_2}
\end{equation}

Where $R_1 C_1$ and $R_2 C_2$ represent the distinct time constants for the fast and slow polarization phenomena, respectively.

And the terminal voltage $V_t(t)$ is now described by:

\begin{equation}
	\label{eq:vt_2rc}
	V_t(t) = V_{OCV}(SoC) - I(t)R_0 - V_1(t) - V_2(t)
\end{equation}

The inclusion of the second RC pair allows the 2RC model to provide a more accurate fit to experimental data, especially under highly dynamic load profiles where multiple polarization effects are significant \cite{khalfi2021electric}. This improved accuracy, however, comes at the cost of increased computational complexity. The BMS must now track three internal states instead of two, and, more importantly, it must identify and update two additional variable parameters ($R_2$ and $C_2$), which also depend non-linearly on SoC, temperature, and SoH.

\subsection{Partnership for a New Generation of Vehicles (PNGV) Model}

Another common structure found in the literature is the model developed by the Partnership for a New Generation of Vehicles (PNGV) initiative\cite{tekin2024comparative}. At first glance, the PNGV model appears structurally similar to the 1RC model, as it contains one ohmic resistor ($R_0$) and a single RC pair ($R_1$, $C_1$) to model the transient polarization dynamics, but some improvements are proposed in order to achieve higher fidelity\cite{Tao2023,Xinyu2025}. The improved PNGV model proposed, exposed in Figure \ref{fig:ecm-models}, consists in the introduction of a capacitor ($C_0$) in series with the internal resistor ($R_0$) and 2RC pairs. 

The PNGV model has 4 states, including the voltage of the capacitor $C_0$. Therefore the equations that describes the state derivatives are Eq. \ref{eq:soc}, Eq. \ref{eq:v1}, Eq. \ref{eq:v2_2rc} and

\begin{equation}
	\label{eq:v0_pngv}
	\frac{dV_0(t)}{dt} =  \frac{I(t)}{C_0}
\end{equation}

And the output equation ($V_t$) is now described by:

\begin{equation}
	\label{eq:vt_pngv}
	V_t(t) = V_{OCV}(t) - I(t)R_0 - V_0(t)-V_1(t)-V_2(t)
\end{equation}

The $V_{OCV}(SoC)$ relationship is known to be highly non-linear, especially for LFP (Lithium Iron Phosphate) chemistries. Approximating this curve with a single, constant capacitance $C_0$ is only accurate for a very small SoC range. To maintain accuracy, the $C_0$ parameter itself must be varied as a non-linear function of the voltage $V_{OCV}$ or SoC\cite{tekin2024comparative}. This model, therefore, still faces the same central challenge as all other ECMs.

The targeted enhancements of the 2RC-PNGV modeling frameworks lead to measurable improvements in state estimation accuracy and estimator robustness, with \cite{Tao2023} reporting a very low relative SoC estimation error of 0.85$\%$ for $LiFePO_4$ blade cells using an improved OCV-based PNGV model\cite{Tao2023,Xinyu2025}. demonstrating that a 2RC-PNGV model coupled with adaptive Sage-Husa $H_{\infty}$ filtering enhances power state estimation under multi-parameter constraints\cite{Xinyu2025}.

\section{System Identification Methods}

\subsection{Transfer function model}

An alternative approach to parameter identification moves from the time-domain state-space representation to the Laplace s-domain, treating the battery as a linear system and approximating its behavior with a transfer function, the ECM transfer function being obtained by applying the Laplace transform to the output equation under the assumptions that the input is the current $\left(I(s)\right)$ and that the OCV–SoC relation is linear $\left(V_{OCV}=k\,SoC\right)$, and it is important to note that the initial conditions are not zero since the initial SoC is typically close to 1 .

Therefore, for the 1RC model the transfer function is:
\begin{equation}
	\label{eq:tf_1rc}
	V_{t,1RC}(s) = -\left[\frac{k\eta}{Qs}+R_0+\frac{1}{1+R_1C_1s}\right]I(s)+ \frac{kSoC(0)}{s}
\end{equation}

Similarly, for the 2RC model and for the 2-RC PNGV, respectively:
\begin{eqnarray}
	\label{eq:tf_2rc}
	V_{t,2RC}(s) = -\left[\frac{k\eta}{Qs}+R_0+\frac{1}{1+R_1C_1s}+\right\\
	\nonumber \left +\frac{1}{1+R_2C_2s}\right]I(s)+ \frac{kSoC(0)}{s}
\end{eqnarray}

\begin{eqnarray}
	\label{eq:tf_pngv}
	V_{t,PNGV}(s) = -\left[\frac{k\eta}{Qs}+R_0+\frac{1}{C_0}+\frac{1}{1+R_1C_1s}+\right\\
	\nonumber\left +\frac{1}{1+R_2C_2s}\right]I(s)+ \frac{kSoC(0)}{s}
\end{eqnarray}

While powerful, this approach is only valid if the system is assumed to be linear time invariant (LTI), which implies that the parameters are modeled as constants and the relationship between SOC and OCV must be also linear, which also implies due to the system's non-linearities, that the obtained transfer function would only approximate its dynamics locally.

Using dynamic input-output data, the function `tfest`, from the MATLAB System Identification Toolbox,  can be employed. This function estimates the coefficients of a transfer function $G(s)$ of a specified order (number of poles and zeros) that best fits the measured input-output data.

Therefore, for the proposed ECM models, the 1-RC model could be modeled as , the 2-RC model, and the PNGV can be modeled as a . This "black-box" time-domain modeling approach is a fast and effective method for capturing the system's dynamics without iterative optimization\cite{khalfi2021boxjenkins, pai2023online}. After estimating the transfer function, the ECM’s physical parameters cannot be uniquely extracted from the resulting coefficients by algebraic manipulation, since each pole is determined by an R·C product that makes individual estimation of R and C impossible.

\subsection{Grey-Box Identification with Differentiable Solvers}

The transfer function method, while fast, forces a critical simplification: the system must be treated as LTI. This fundamentally conflicts with the known physics of a battery, where parameters are non-linear functions of state\cite{tran2021comprehensive}. A more robust approach is "grey-box" identification were non-linear state space structure of the ECM can be retained and perform an optimization to find the parameters $\theta = \{R_0, R_1, C_1, R_2, C_2,n, \dots\}$ that minimize the error between the simulated voltage $V_{model}$ and the experimental data $V_{exp}$. This creates a complex, non-linear optimization problem. Historically, solving such problems was difficult, often requiring gradient-free methods or manual derivation of gradients.

A modern solution is found in the Python environment through "differentiable programming". This approach leverages the \texttt{JAX} library for automatic differentiation (\texttt{jax.grad}) and just-in-time (\texttt{jit}) compilation\cite{kidger2021diffrax}. The ECM, which is a system of ODEs, can be implemented using a differentiable ODE solver,such as \texttt{Diffrax}.

The entire simulation process, from integrating the ODEs with \texttt{Diffrax} to calculating the final voltage error (Eq. \ref{eq:vt_2rc}), becomes a single, end-to-end differentiable function that can have the exact gradient of the loss function, with respect of each component of $\theta$, computed automatically and efficiently using the  \texttt{jax.grad} function. These gradients are then fed into a high-performance optimizer to solve the minimization problem.

A standard simulation ("single shooting") integrates the ODE from $t_0$ to $t_{final}$. If the time-series data is long,as in a drive cycle, this approach can be numerically unstable, suffering from vanishing or exploding gradients. A more robust strategy is multiple shooting, where the full time-series is partitioned into $m$ smaller, independent intervals. The optimization problem is then reformulated as:
\begin{enumerate}
	\item Find the global parameters $\theta$.
	\item Find the local initial states $x_i$ for each interval $i \in [1, m]$.
	\item Minimize the sum of simulation errors within all intervals.
	\item Add a "continuity constraint" to the loss function, penalizing any mismatch between the simulated end-state of interval $i$ and the (optimized) initial state of interval $i+1$.
\end{enumerate}

This strategy stabilizes the optimization, as gradients only need to propagate through short time windows. Furthermore, the simulation of all $m$ intervals is perfectly parallelizable, which can be efficiently implemented using \texttt{jax.vmap}. This \texttt{JAX/Diffrax} implementation allows for the handling of fully non-linear models. This results in a continuous model that generalizes across the entire operating range, bridges the gap between simple ECMs and complex physical models, and is a key concept in Scientific Machine Learning \cite{rackauckas2020universal}.

\subsection{Proposed Hybrid LPV-NN Model Architecture}

The central challenge in ECM accuracy, as established in the literature, is that the model parameters are not constant. They are highly non-linear functions of the battery's internal states, primarily the State of Charge (SoC) and temperature, as well as its State of Health (SoH)\cite{tran2021comprehensive, yang2023improved}. The "grey-box" identification method described previously is effective at finding a single, static set of $p$ parameters, $\theta_{p, nominal}$, valid at a specific operating point.

To create a model with high fidelity across the entire operating range, a hybrid, phenomenological model structured as a Linear Parameter-Varying (LPV) system is proposed. In this architecture, the underlying ECM structure and its state-space equations are preserved. However, the parameter vector $(\theta_p)_{p\times 1}$ is no longer static. Instead, it is defined as a dynamic function of a scheduling vector, $\mathbf{x}$, defined by the most dominant non-linear dependency:
\begin{equation}
	\label{eq:scheduling_vector}
	\mathbf{x} = [SoC(t)]
\end{equation}

The instantaneous parameter value $\theta_p(\mathbf{x})$ as a non-linear deviation from the nominal parameters $\theta_{p, nominal}$ obtained via the grey-box identification. This relationship is defined as:

\begin{equation}
	\label{eq:lpv_param}
	\theta_p(\mathbf{x}) = \theta_{p, nominal}^T(1_{p\times 1} + \delta_{NN}(\mathbf{x}))
\end{equation}

Where $\delta_{NN}(\mathbf{x})$ is a vector of scaling factors output by a shallow Neural Network (NN). This NN is specifically tasked with learning the non-linear dependency $\delta = f(SoC)$. This formulation is advantageous as it anchors the model to a physically-identified baseline ($\theta_{p, nominal}$) and uses the NN only to learn the variation. Another possible approach is to tune the NN along $\theta_{p, nominal}$, adjusting the nominal parameters together with its variation.

Three primary architectures for the mapping function $\delta_{NN}(\mathbf{x})$ shall be explored:

\subsubsection{Multi-Layer Perceptron (MLP)}

A standard feedforward neural network with a single hidden layer is proposed, taking the SoC as input and outputting the vector $\delta_{NN}$. The hidden layer uses the Rectified Linear Unit (ReLU) to provide computational efficiency and mitigate vanishing gradients during training, or the hyperbolic tangent ($\tanh$) that bounds the neurons outputs to [-1, 1], a natural constraint for $\delta_{NN}$, that prevents the optimizer from producing physically unrealistic parameters such as negative resistances or capacitances.

\subsubsection{Radial Basis Function Neural Network (RBFNN)}

A RBFNN is a powerful universal approximator, particularly well-suited for low-dimensional interpolation problems\cite{broomhead1988radial}, where the network's output is a weighted sum of radial basis functions. The key advantage is that the basis functions create "local" responses, allowing the model to fit the parameter variations in specific SoC regions without adversely affecting others. This architecture is often more data-efficient than MLPs when the input dimension is small\cite{broomhead1988radial}.

Considering $c$ as the center of a neuron, $\beta$ as the spread, and $w$ as the weight of the activation function, the adopted radial basis functions are described bellow:
\begin{itemize}
	\item Gaussian (GS):
	\begin{equation}
		f(x)=we^{\frac{-\|x-c\|^2}{2\beta^2}}
	\end{equation}
	\item Inverse Quadric (IQD):
	\begin{equation}
		f(x) = \frac{w}{\|x-c\|^2+\beta^2}
	\end{equation}
	\item Inverse Quadratic (IQT):
	\begin{equation}
		f(x) = \frac{w}{\sqrt{\|x-c\|^2+\beta^2}}
	\end{equation}
	\item Hyperbolic Tangent (TH)
	\begin{equation}
		f(x) = 1-\tanh\left(\frac{\|x-c\|^2}{2\beta^2}\right)
	\end{equation}
	\item Thin Plate Spline (TPS):
	\begin{equation}
		f(x) = \|x-c\|^2\log\left(\|x-c\|\right)
	\end{equation}
\end{itemize}

\subsubsection{Wavelet Neural Networks}

Wavelet Neural Network (WNN) are a powerful class of feedforward neural networks that substitute the traditional sigmoidal or radial basis functions (RBFs) with mother wavelets. This substitution grants the network multi-resolution analysis capabilities, making it highly effective for approximating functions with varying degrees of smoothness, a key requirement for complex battery characteristics \cite{Sahoo2023LBFGS}. For this network structure, the output is defined by:

\begin{equation}
	y_k = b_{k}^{\text{out}} + \sum_{j=1}^{N} W_{kj} \cdot \psi\left(\frac{\mathbf{x}_{\text{in}} - \mathbf{b}_j}{a_j}\right)
\end{equation}

where $N$ is the number of hidden neurons, $W_{kj}$ are the output weights, $b_{k}^{\text{out}}$ is the output bias, and $\psi(\cdot)$ is the chosen mother wavelet. The parameters $\mathbf{b}_j$ and $a_j$ represent the translation and dilation (scale) factors, respectively, of the $j$-th wavelet. The network parameters $\Theta_{\text{WNN}} = \{W_{kj}, b_{k}^{\text{out}}, \mathbf{b}_j, a_j\}$ are optimized alongside the system states within the Multiple Shooting framework.

The activation function $\psi(\cdot)$ employed in the hidden layer is the Mexican Hat Wavelet (also known as the Ricker Wavelet), which corresponds to the negative second derivative of the Gaussian function. For a scalar input $t$, the Mexican Hat is given by:

\begin{equation}
	\psi_{\text{MH}}(t) = (1 - t^2) e^{-t^2/2}, \quad \text{where} \quad t = \frac{x_{in} - b}{a}
	\label{eq:mexican_hat}
\end{equation}

The Mexican Hat wavelet is particularly advantageous for non-linear regression and dynamic system identification due to several key properties. Primarily, its smooth, Gaussian-derived profile ensures infinite differentiability ($\mathcal{C}^\infty$), which is essential for the efficient training of our JAX-based model. This guarantees that the gradient of the loss function is continuous and well-behaved across the optimization domain, mitigating the risk of vanishing or ill-defined gradients associated with non-smooth wavelets like Haar \cite{Kumar2024Corneal,Sahoo2023LBFGS}. Furthermore, the Gaussian envelope provides superior time-frequency localization with exponential decay, a property crucial for enabling each neuron to effectively map parameter changes within a specific, small operating region of the battery (e.g., across a small SOC window). This fast decay is preferred over the slow algebraic decay ($1/t$) of the Shannon (sinc) wavelet. Finally, the symmetry and the zero-mean property ($\int_{-\infty}^{\infty} \psi_{\text{MH}}(t) dt = 0$) offer a robust and fundamental basis for function approximation, allowing the network to effectively capture and distinguish between local oscillations and global trends in the target LPV parameters\cite{Kumar2024Corneal}.

\subsubsection{Advantages and limitations of the Hybrid Approach}

The hybrid ECM–NN approach combines physics-informed interpretability with data-driven flexibility by preserving the ECM state-space and using the neural network exclusively to schedule model parameters rather than to function as a black box \cite{takyi2023narx, xia2024hybrid} It captures strong nonlinear dependencies that simpler online estimators such as standard RLS or LTI transfer-function methods fail to represent \cite{tran2021comprehensive, pai2023online} By implementing the ECM ODEs solved with \texttt{Diffrax} together with the NN parameter functions as a single differentiable program in \texttt{JAX}, the NN weights are incorporated into the overall parameter vector ($\theta$) optimized by the grey-box solver, enabling the model to learn parameter variations across the operating range from a single dynamic dataset This integration yields high-fidelity interpolation within the training domain while retaining the intrinsic risk of poor generalization and extrapolation for underrepresented SoC or temperature regions in the dataset \cite{valizadeh2024machine, kawahara2023battery}.

\subsection{Performance Metrics}

To evaluete and compare the performance of the system identification techniques presented in this paper, the root mean square error (RMSE), and the $R^2$ correlation factor were calculated. These metrics are described by the following equations:

\begin{equation}
	RMSE = \sqrt{\frac{\sum_{i=1}^{N}(y_i-\hat{y}_i)^2}{N}}
\end{equation}
\begin{equation}
	R^2 = 1-\frac{\sum_{k=1}^N(y(k)-\hat{y}(k))^2}{\sum_{k=1}^N(y(k)-\bar{y})^2}
\end{equation}
where $N$ is the number of samples and $\bar{y}$ is the mean value of all output samples.


\section{Experimental Dataset}

The experimental dataset used in this paper were extracted from \cite{Sheikh2024}, which involved identifying sparse linear parameter-varying (LPV) models for a 1 Ah lithium-ion NMC/graphite battery using both synthetic and real-world drive-cycle current profiles. A custom-designed synthetic input signal, shown in Figure , was crafted to mimic the dynamic characteristics of practical drive cycles while ensuring informative excitation across the battery’s operating range. This signal incorporated randomized pulse durations, rest periods, and noise to capture a wide spectrum of battery behaviors. For validation, a real drive-cycle current profile was used (Figure ), enabling assessment of the model’s simulation accuracy under realistic conditions. A separate $SoC-V_{OCV}$ dataset is also available for regressing a polynomial function to model this correlation.

\section{Results}

Based on the previously described transfer functions, the \textit{tfest} function was used to fit models with 2, 3, 4, and 5 poles. This variation in order aimed to represent, respectively, the 1RC, 2RC, and 2RC-PNGV models, in addition to a higher-order model to capture any unmodeled dynamics that the 2RC-PNGV did not cover. For all fittings, the number of zeros was fixed as equal to the number of poles. Although all three ECM models were employed in the construction of the grey-box models, only the 1RC model was considered in the proposed hybrid approaches that utilize MLP-NN, RBF-NN, and WNN with the specified activation functions. The metrics obtained are exposed in Table and .

\begin{table}\label{tab:metrics}
	\centering
	\caption{Metrics of performance of the tuned models.}
	\begin{tabular}{c|c|c}
		
		Model& $R^2$ & MSE  \\
		\hline
		TF - order 2 &  &  \\
		TF - order 3 &  &  \\
		TF - order 4 &  &  \\
		TF - order 5 &  &  \\
		\hline
		GB - 1RC &  &  \\
		GB - 2RC &  &  \\
		GB - PNGV &  &  \\
		\hline
		GB+MLP - ReLu&  &  \\
		GB+MLP - Tanh&  &  \\
		GB+RBF - GS&  &  \\
		GB+RBF - IQD&  &  \\
		GB+RBF - IQT&  &  \\
		GB+RBF - TH&  &  \\
		GB+RBF - TPS&  &  \\
		GB+WNN - Hat&  &  \\
		\hline
	\end{tabular}
\end{table}


The estimated responses for the best-performing transfer function, the best grey-box model, and the best hybrid approach are displayed in Figure .

Figure X compares the estimated system responses obtained using the best activation function across the three neural network architectures. The corresponding errors are compared in Figure Y. Finally, a scatter plot detailing the performance of the best hybrid approach is presented in Figure Z.

\section{Result Analysis}


\section{Conclusion}

\bibliographystyle{ieeetr}
\bibliography{export.bib}
\end{document}	

